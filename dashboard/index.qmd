---
title: "Forecasting Challenge"
---

Welcome the Virginia Ecoforecast Reservoir Analysis ([VERA](http://ltreb-reservoirs.org/)) Forecasting Challenge, hosted by the Ecological Forecasting Project at Virginia Tech. ([EFP](https://www.ecoforecastprojectvt.org/))

We invite you to submit forecasts!

## Why a forecasting challenge? 

We are using forecasts to compare the predictability of different ecosystem variables, in different ecosystem conditions to identify the fundamental predictability of freshwater ecosystems.

<br />
<br />
```{r setup, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(dplyr)
library(arrow)
library(bslib)
library(bsicons)
library(leaflet)
library(tidyverse)
config <- yaml::read_yaml("../challenge_configuration.yaml")
sites <- suppressMessages(sf::st_read("sites.json"))
s3_inventory <- arrow::s3_bucket(paste0(config$inventory_bucket, "/catalog"), endpoint_override = config$endpoint, anonymous = TRUE)
n_forecasts <- arrow::open_dataset(s3_inventory) |> distinct(model_id, reference_date) |> collect() |> nrow()
n_models <- arrow::open_dataset(s3_inventory) |> distinct(model_id) |> collect() |> nrow()

url <- "https://renc.osn.xsede.org/bio230121-bucket01/vera4cast/targets/duration=P1D/P1D-targets.csv.gz"
most_recent_targets <- readr::read_csv(url, show_col_types = FALSE) |> 
  summarize(max = max(datetime)) |> 
  mutate(max = lubridate::as_date(max)) |> 
  pull(max)

unique_targets <- readr::read_csv(url, show_col_types = FALSE) |> 
  dplyr::distinct(variable) |> count() |> 
  pull(n)

last_updated <- Sys.Date()
```

```{r}

layout_column_wrap(
  width = "250px",
  value_box(
    title = "Total forecasts submitted to the VERA Challenge", 
    value = n_forecasts,
    showcase = bs_icon("graph-up"),
    theme_color = "success" 
  ),
  value_box(
    title = "Most recent data for model training", 
    value = most_recent_targets,
    showcase = bs_icon("bullseye")
  ),
    value_box(
    title = "Number of variables being forecasted", 
    value = unique_targets,
    showcase = bs_icon("clipboard-data"),
    theme_color = "success" 
  )
)

```
<br />
<br />

## What sites are being forecasted?

```{r fig.height=5, fig.width=5, echo=FALSE, include=TRUE, message = FALSE}
leaflet() %>%
  setView(lat = 37.310922, lng = -79.828854, zoom= 15) %>%
  addTiles(group="OSM") %>%
  addProviderTiles(providers$Esri.WorldImagery, group="Imagery") %>%
  addProviderTiles(providers$Esri.WorldTopoMap, group="Topo Map") %>%
  addLayersControl(baseGroups=c('Imagery','OSM', 'Topo Map')) |> 
  addMarkers(data  = sites, popup=~as.character(site_id), group = ~as.character(Partner), clusterOptions = markerClusterOptions())
```
<br />
<br />
This material is based upon work supported by the National Science Foundation under Grant DEB-2327030. Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.
<br />
<br />
Page last updated on `r Sys.Date()`
