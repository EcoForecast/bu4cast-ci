---
title: "What to forecast"
editor: 
  markdown: 
    wrap: sentence
---

```{r  message=FALSE, echo = FALSE}
library(tidyverse)
terrestrial_focal_sites <- c("HARV", "OSBS")
aquatics_focal_sites <- c("BARC", "CRAM")
phenology_focal_sites <- c("HARV", "OSBS")
ticks_focal_sites <- c("HARV", "OSBS")
beetles_focal_sites <- c("HARV", "OSBS")
```

```{r message=FALSE, echo = FALSE}
googlesheets4::gs4_deauth()
target_metadata <- googlesheets4::read_sheet("https://docs.google.com/spreadsheets/d/10YTX9ae_C1rFdLgEDkUcCRCpUkVYv06leY01BtD1BgM/edit?usp=sharing")
```

```{r echo = FALSE}
  target_metadata <- target_metadata |> 
  rename(variable = `"official" targets name`) |> 
  select(variable, duration, class, Description, horizon)
```

The targets were specifically chosen to include ecosystem, community, and population dynamics.
Targets are available at all relative NEON sites.
If you are interested in forecasting a single site, we recommend the following focal sites.

- Terrestrial: HARV
- Aquatics: BARC
- Phenology: HARV 
- Beetles:
- Ticks:

## Targets files

### Terrestrial fluxes

Insert short description

```{r}
url <- "https://sdsc.osn.xsede.org/bio230014-bucket01/challenges/targets/project_id=neon4cast/duration=P1D/terrestrial_daily-targets.csv.gz"
```

```{r}

terrestrial_targets <- read_csv(url, show_col_types = FALSE)
```

```{r}
glimpse(terrestrial_targets)
```

```{r echo = FALSE}
terrestrial_targets |> 
  distinct(variable, duration) |> 
  left_join(target_metadata, by = c("variable","duration")) |> 
  filter(variable %in% c("nee","le")) |> 
  select(-class) |> 
  knitr::kable()
```

```{r}
terrestrial_targets |> 
  filter(site_id %in% c("HARV", "OSBS")) |> 
  ggplot(aes(x = datetime, y = observation)) +
  geom_point() +
  facet_grid(variable~site_id, scales = "free_y") +
  theme_bw()

```

Learn more at: <https://projects.ecoforecast.org/neon4cast-docs/Terrestrial.html>

### Aquatics

```{r}
url <- "https://sdsc.osn.xsede.org/bio230014-bucket01/challenges/targets/project_id=neon4cast/duration=P1D/aquatics-targets.csv.gz"
```

```{r}
aquatics_targets <- read_csv(url, show_col_types = FALSE)
```

```{r}
glimpse(aquatics_targets)
```

```{r echo = FALSE}
aquatics_targets |> 
  distinct(variable, duration) |> 
  left_join(target_metadata, by = c("variable","duration")) |> 
  filter(variable %in% c("temperature","oxygen", "chla")) |> 
  select(-class) |> 
  knitr::kable()
```

```{r}
aquatics_targets |> 
  filter(site_id %in% c("BARC", "CRAM")) |> 
  ggplot(aes(x = datetime, y = observation)) +
  geom_point() +
  facet_grid(variable~site_id, scales = "free_y") +
  theme_bw()

```

Learn more at: <https://projects.ecoforecast.org/neon4cast-docs/Aquatics.html>

### Phenology

```{r}
url <- "https://sdsc.osn.xsede.org/bio230014-bucket01/challenges/targets/project_id=neon4cast/duration=P1D/phenology-targets.csv.gz"
```

```{r}
phenology_targets <- read_csv(url, show_col_types = FALSE)
```

```{r}
glimpse(phenology_targets)
```

```{r echo = FALSE}
phenology_targets |> 
  distinct(variable, duration) |> 
  left_join(target_metadata, by = c("variable","duration")) |> 
  filter(variable %in% c("gcc_90","rcc_90")) |> 
  select(-class) |> 
  knitr::kable()
```

```{r}
phenology_targets |> 
  filter(site_id %in% c("HARV", "OSBS")) |> 
  ggplot(aes(x = datetime, y = observation)) +
  geom_point() +
  facet_grid(variable~site_id, scales = "free_y") +
  theme_bw()

```

Learn more at: <https://projects.ecoforecast.org/neon4cast-docs/Phenology.html>

### Beetle communities

```{r}
url <- "https://sdsc.osn.xsede.org/bio230014-bucket01/challenges/targets/project_id=neon4cast/duration=P1W/beetles-targets.csv.gz"
```

```{r}
beetles_targets <- read_csv(url, show_col_types = FALSE)
```

```{r}
glimpse(beetles_targets)
```

```{r echo = FALSE}
beetles_targets |> 
  distinct(variable, duration) |> 
  left_join(target_metadata, by = c("variable","duration")) |> 
  filter(variable %in% c("abundance","richness")) |> 
  select(-class) |> 
  knitr::kable()
```

```{r}
beetles_targets |> 
  filter(site_id %in% c("HARV", "OSBS")) |> 
  ggplot(aes(x = datetime, y = observation)) +
  geom_point() +
  facet_grid(variable~site_id, scales = "free_y") +
  theme_bw()
```

Learn more at: <https://projects.ecoforecast.org/neon4cast-docs/Beetles.html>

### Tick populations

```{r}
url <- "https://sdsc.osn.xsede.org/bio230014-bucket01/challenges/targets/project_id=neon4cast/duration=P1W/ticks-targets.csv.gz"
```

```{r}
ticks_targets <- read_csv(url, show_col_types = FALSE)
```

```{r}
glimpse(ticks_targets)
```

```{r echo = FALSE}
beetles_targets |> 
  distinct(variable, duration) |> 
  left_join(target_metadata, by = c("variable","duration")) |> 
  filter(variable %in% c("amblyomma_americanum")) |> 
  select(-class) |> 
  knitr::kable()
```

```{r}
ticks_targets |> 
  filter(site_id %in% c("BLAN", "OSBS")) |> 
  ggplot(aes(x = datetime, y = observation)) +
  geom_point() +
  facet_grid(variable~site_id, scales = "free_y") +
  theme_bw()
```

Learn more at: [https://projects.ecoforecast.org/neon4cast-docs/Beetles.html](https://projects.ecoforecast.org/neon4cast-docs/Ticks.html)

## Sites

The following table lists all the sites in the NEON Ecological Forecasting Challenge along with the "themes" that it is included it.

```{r}
site_list <- read_csv("../neon4cast_field_site_metadata.csv", show_col_types = FALSE) |> 
  rename(site_id = field_site_id) |> 
  select(site_id, field_site_name, terrestrial, aquatics, phenology, ticks, beetles) 
```

```{r echo = FALSE}
site_list |> knitr::kable()
```

## Additional variables

### Hourly water temperature

Daily time-step variables measured in the monitored stream (Tunnel Branch; site_id = tubr)

```{r}
url <- "https://sdsc.osn.xsede.org/bio230014-bucket01/challenges/targets/project_id=neon4cast/duration=PT1H/aquatics-expanded-observations.csv.gz"

aquatics_expanded <- read_csv(url, show_col_types = FALSE)
glimpse(aquatics_expanded)
```
